<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of getRxnsFromMetaCyc</title>
  <meta name="keywords" content="getRxnsFromMetaCyc">
  <meta name="description" content="getRxnsFromMetaCyc">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">external</a> &gt; <a href="index.html">metacyc</a> &gt; getRxnsFromMetaCyc.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for external\metacyc&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>getRxnsFromMetaCyc
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>getRxnsFromMetaCyc</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> getRxnsFromMetaCyc
   Retrieves reactions information from MetaCyc database

   Input:
   metacycPath         if metaCycRxns.mat is not in the RAVEN\external\metacyc
                       directory, this function will attempt to build it by
                       reading info from a local dump of MetaCyc database,
                       metacycPath is the path to the MetaCyc data files
   keepTransportRxns   include transportation reactions, which often have identical
                       reactants and products that turn to be all-zero columns in
                       the S matrix (opt, default false)
   keepUnbalanced      include reactions cannot be balanced, usually
                       because they are polymeric reactions or with
                       specific difficulty in balancing class structures
                       (opt, default false)
   keepUndetermined    include reactions that have substrates lack chemical
                       structures or with non-numerical coefficients (e.g. n+1)
                       (opt, default false)

   Output:
   model     a model structure generated from the database. The following
             fields are filled
             id:             'MetaCyc'
             name:    'Automatically generated from MetaCyc database'
             rxns:           MetaCyc reaction ids
             rxnNames:       Name for each reaction entry
             mets:           MetaCyc compound ids. If the equations use
                             stoichiometry such as ID(n+1) then the whole
                             expression is saved as the id
             pwys:           MetaCyc pathway id
             eccodes:        Corresponding ec-number if available
             rxnMiriams:     Contains reaction specific information such as
                             associated RHEA and KEGG reaction ids
             S:              Stoichiometric matrix
             lb:             -1000 for all reactions
             ub:             1000 for all reactions
             rev:            1 for reversible and 0 for irreversible. For
                             reactions present in pathway maps the reversibility
                             is taken from there
             b:              0 for all metabolites
             version:        MetaCyc database version

   If the file metaCycRxns.mat is in the RAVEN/external/metacyc directory, it
   will be directly loaded instead of parsing the MetaCyc data files and
   pre-prepared lists of MetaCyc transport and undetermined reactions.

   Usage: model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="getModelFromMetaCyc.html" class="code" title="function metaCycModel=getModelFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)">getModelFromMetaCyc</a>	getModelFromMetaCyc</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function newString=removeHTMLcodes(string)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)</a>
0002 <span class="comment">% getRxnsFromMetaCyc</span>
0003 <span class="comment">%   Retrieves reactions information from MetaCyc database</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   Input:</span>
0006 <span class="comment">%   metacycPath         if metaCycRxns.mat is not in the RAVEN\external\metacyc</span>
0007 <span class="comment">%                       directory, this function will attempt to build it by</span>
0008 <span class="comment">%                       reading info from a local dump of MetaCyc database,</span>
0009 <span class="comment">%                       metacycPath is the path to the MetaCyc data files</span>
0010 <span class="comment">%   keepTransportRxns   include transportation reactions, which often have identical</span>
0011 <span class="comment">%                       reactants and products that turn to be all-zero columns in</span>
0012 <span class="comment">%                       the S matrix (opt, default false)</span>
0013 <span class="comment">%   keepUnbalanced      include reactions cannot be balanced, usually</span>
0014 <span class="comment">%                       because they are polymeric reactions or with</span>
0015 <span class="comment">%                       specific difficulty in balancing class structures</span>
0016 <span class="comment">%                       (opt, default false)</span>
0017 <span class="comment">%   keepUndetermined    include reactions that have substrates lack chemical</span>
0018 <span class="comment">%                       structures or with non-numerical coefficients (e.g. n+1)</span>
0019 <span class="comment">%                       (opt, default false)</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%   Output:</span>
0022 <span class="comment">%   model     a model structure generated from the database. The following</span>
0023 <span class="comment">%             fields are filled</span>
0024 <span class="comment">%             id:             'MetaCyc'</span>
0025 <span class="comment">%             name:    'Automatically generated from MetaCyc database'</span>
0026 <span class="comment">%             rxns:           MetaCyc reaction ids</span>
0027 <span class="comment">%             rxnNames:       Name for each reaction entry</span>
0028 <span class="comment">%             mets:           MetaCyc compound ids. If the equations use</span>
0029 <span class="comment">%                             stoichiometry such as ID(n+1) then the whole</span>
0030 <span class="comment">%                             expression is saved as the id</span>
0031 <span class="comment">%             pwys:           MetaCyc pathway id</span>
0032 <span class="comment">%             eccodes:        Corresponding ec-number if available</span>
0033 <span class="comment">%             rxnMiriams:     Contains reaction specific information such as</span>
0034 <span class="comment">%                             associated RHEA and KEGG reaction ids</span>
0035 <span class="comment">%             S:              Stoichiometric matrix</span>
0036 <span class="comment">%             lb:             -1000 for all reactions</span>
0037 <span class="comment">%             ub:             1000 for all reactions</span>
0038 <span class="comment">%             rev:            1 for reversible and 0 for irreversible. For</span>
0039 <span class="comment">%                             reactions present in pathway maps the reversibility</span>
0040 <span class="comment">%                             is taken from there</span>
0041 <span class="comment">%             b:              0 for all metabolites</span>
0042 <span class="comment">%             version:        MetaCyc database version</span>
0043 <span class="comment">%</span>
0044 <span class="comment">%   If the file metaCycRxns.mat is in the RAVEN/external/metacyc directory, it</span>
0045 <span class="comment">%   will be directly loaded instead of parsing the MetaCyc data files and</span>
0046 <span class="comment">%   pre-prepared lists of MetaCyc transport and undetermined reactions.</span>
0047 <span class="comment">%</span>
0048 <span class="comment">%   Usage: model=getRxnsFromMetaCyc(metacycPath,keepTransportRxns,keepUnbalanced,keepUndetermined)</span>
0049 
0050 <span class="comment">%NOTE: This is how one entry looks in the file</span>
0051 
0052 <span class="comment">% UNIQUE-ID - 4-HYDROXY-2-KETOPIMELATE-LYSIS-RXN</span>
0053 <span class="comment">% TYPES - Small-Molecule-Reactions</span>
0054 <span class="comment">% TYPES - Chemical-Reactions</span>
0055 <span class="comment">% ATOM-MAPPINGS - (:NO-HYDROGEN-ENCODING (6 7 0 8 1 9 2 10 3 12 11 5 4) (((PYRUVATE 0 5) (SUCC-S-ALD 6 12)) ((CPD-804 0 12))))</span>
0056 <span class="comment">% DBLINKS - (LIGAND-RXN &quot;R01647&quot; NIL |kr| 3650824949 NIL NIL)</span>
0057 <span class="comment">% DBLINKS - (LIGAND-RXN &quot;R01645&quot; NIL |taltman| 3459474590 NIL NIL)</span>
0058 <span class="comment">% EC-NUMBER - EC-4.1.2.52</span>
0059 <span class="comment">% ^OFFICIAL? - T</span>
0060 <span class="comment">% ENZYMATIC-REACTION - ENZRXN-3009</span>
0061 <span class="comment">% IN-PATHWAY - 3-HYDROXYPHENYLACETATE-DEGRADATION-PWY</span>
0062 <span class="comment">% LEFT - CPD-804</span>
0063 <span class="comment">% ORPHAN? - :NO</span>
0064 <span class="comment">% PHYSIOLOGICALLY-RELEVANT? - T</span>
0065 <span class="comment">% REACTION-DIRECTION - LEFT-TO-RIGHT</span>
0066 <span class="comment">% RIGHT - SUCC-S-ALD</span>
0067 <span class="comment">% RIGHT - PYRUVATE</span>
0068 <span class="comment">% //</span>
0069 
0070 <span class="comment">% A line that contains only '//' separates each object.</span>
0071 
0072 <span class="keyword">if</span> nargin&lt;2
0073     keepTransportRxns=false;
0074 <span class="keyword">end</span>
0075 <span class="keyword">if</span> nargin&lt;3
0076     keepUnbalanced=false;
0077 <span class="keyword">end</span>
0078 <span class="keyword">if</span> nargin&lt;4
0079     keepUndetermined=false;
0080 <span class="keyword">end</span>
0081 
0082 <span class="comment">%Check if the reactions have been parsed before and saved. Directly load</span>
0083 <span class="comment">%the model if so.</span>
0084 ravenPath=findRAVENroot();
0085 rxnsFile=fullfile(ravenPath,<span class="string">'external'</span>,<span class="string">'metacyc'</span>,<span class="string">'metaCycRxns.mat'</span>);
0086 metaCycRxnFile=<span class="string">'reactions.dat'</span>;
0087 metaCycPwyFile=<span class="string">'pathway-links.dat'</span>;
0088 
0089 <span class="keyword">if</span> exist(rxnsFile, <span class="string">'file'</span>)
0090     fprintf([<span class="string">'Importing MetaCyc reactions from '</span> strrep(rxnsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">'... '</span>]);
0091     load(rxnsFile);
0092     fprintf(<span class="string">'done\n'</span>);
0093 <span class="keyword">else</span>
0094     fprintf([<span class="string">'Cannot locate '</span> strrep(rxnsFile,<span class="string">'\'</span>,<span class="string">'/'</span>) <span class="string">'\nNow try to generate it from local MetaCyc data files...\n'</span>]);
0095     <span class="keyword">if</span> ~exist(fullfile(metacycPath,metaCycRxnFile),<span class="string">'file'</span>) || ~exist(fullfile(metacycPath,metaCycPwyFile),<span class="string">'file'</span>)
0096         EM=fprintf([<span class="string">'The files of reactions or pathways cannot be located, and should be downloaded from MetaCyc.\n'</span>]);
0097         dispEM(EM);
0098     <span class="keyword">else</span>
0099         metaCycRxns.id=<span class="string">'MetaCyc'</span>;
0100         metaCycRxns.name=<span class="string">'Automatically generated from MetaCyc database'</span>;
0101         
0102         <span class="comment">%Get pathway names and add them to the field of subSystems</span>
0103         fid = fopen(fullfile(metacycPath,metaCycPwyFile), <span class="string">'r'</span>);
0104         
0105         <span class="comment">%Keeps track of how many pathways that have been added</span>
0106         pwyCounter=0;
0107         pwys=cell(10000,1);
0108         pwyNames=cell(10000,1);
0109         
0110         <span class="comment">%Loop through the file</span>
0111         <span class="keyword">while</span> 1
0112             <span class="comment">%Get the next line</span>
0113             tline = fgetl(fid);
0114             
0115             <span class="comment">%Abort at end of file</span>
0116             <span class="keyword">if</span> ~ischar(tline)
0117                 <span class="keyword">break</span>;
0118             <span class="keyword">end</span>
0119             
0120             <span class="comment">%Read in pathway ids and names</span>
0121             <span class="keyword">if</span> ~strcmp(tline(1),<span class="string">'#'</span>)
0122                 pwyCounter=pwyCounter+1;
0123                 vars = regexp(tline, <span class="string">'\t'</span>, <span class="string">'split'</span>);
0124                 pwys{pwyCounter}=vars{1};
0125                 pwyNames{pwyCounter}=vars{2};
0126                 
0127                 <span class="comment">%Romve HTML symbols</span>
0128                 pwyNames{pwyCounter}=<a href="#_sub1" class="code" title="subfunction newString=removeHTMLcodes(string)">removeHTMLcodes</a>(pwyNames{pwyCounter});
0129                 
0130             <span class="keyword">end</span>
0131         <span class="keyword">end</span>
0132         fclose(fid);
0133         pwys=pwys(1:pwyCounter);
0134         pwyNames=pwyNames(1:pwyCounter);
0135         
0136         <span class="comment">%Preallocate memory for 50000 reactions</span>
0137         metaCycRxns.rxns=cell(50000,1);
0138         metaCycRxns.rxnNames=cell(50000,1);
0139         metaCycRxns.eccodes=cell(50000,1);
0140         metaCycRxns.subSystems=cell(50000,1);
0141         metaCycRxns.pwys=cell(50000,1);
0142         metaCycRxns.rxnMiriams=cell(50000,1);
0143         metaCycRxns.rxnReferences=cell(50000,1);
0144         metaCycRxns.rev=ones(50000,1); <span class="comment">%reversibility;</span>
0145         
0146         rxnLinks.metacyc=cell(10000,1);
0147         rxnLinks.kegg=cell(10000,1);
0148         rxnLinks.check=cell(10000,1);
0149         isSpontaneous=false(10000,1); <span class="comment">%spontaneous;</span>
0150         UNBALANCED=false(10000,1);
0151         UNDETERMINED=false(10000,1);
0152         TRANSPORT={};                 <span class="comment">%transport reactions;</span>
0153         
0154         metaCycRxns.equations=cell(50000,1); <span class="comment">%reaction equations</span>
0155         left=cell(50000,1); <span class="comment">%Temporarily stores the equations</span>
0156         right=cell(50000,1); <span class="comment">%Temporarily stores the equations</span>
0157         
0158         <span class="comment">%First load information on reaction ID, reaction name,, pathway,</span>
0159         <span class="comment">%and ec-number</span>
0160         fid = fopen(fullfile(metacycPath,metaCycRxnFile), <span class="string">'r'</span>);
0161         
0162         <span class="comment">%Keeps track of how many reactions that have been added</span>
0163         rxnCounter=0;
0164         addSpont=false;
0165         dbLinkCounter=0;
0166         
0167         <span class="comment">%Loop through the file</span>
0168         <span class="keyword">while</span> 1
0169             <span class="comment">%Get the next line</span>
0170             tline = fgetl(fid);
0171             
0172             <span class="comment">%Abort at end of file</span>
0173             <span class="keyword">if</span> ~ischar(tline)
0174                 <span class="keyword">break</span>;
0175             <span class="keyword">end</span>
0176 
0177             <span class="comment">% Get the version of MetaCyc database</span>
0178             <span class="keyword">if</span> numel(tline)&gt;11 &amp;&amp; strcmp(tline(1:11),<span class="string">'# Version: '</span>)
0179                 version=tline(12:end);
0180             <span class="keyword">end</span>
0181 
0182             <span class="comment">%Check if it is a new reaction</span>
0183             <span class="keyword">if</span> numel(tline)&gt;12 &amp;&amp; strcmp(tline(1:12),<span class="string">'UNIQUE-ID - '</span>)
0184                 rxnCounter=rxnCounter+1;
0185                 nPwys=0;
0186                 
0187                 <span class="comment">%Add empty strings where there should be such</span>
0188                 metaCycRxns.rxnNames{rxnCounter}=<span class="string">''</span>;
0189                 metaCycRxns.eccodes{rxnCounter}=<span class="string">''</span>;
0190                 metaCycRxns.subSystems{rxnCounter}=<span class="string">''</span>;
0191                 metaCycRxns.pwys{rxnCounter}=<span class="string">''</span>;
0192                 metaCycRxns.equations{rxnCounter}=<span class="string">''</span>;
0193                 metaCycRxns.rxnReferences{rxnCounter}=<span class="string">''</span>;
0194                 reverse=0;   <span class="comment">%Value for reversing the equation when necessary</span>
0195                 
0196                 <span class="comment">% A complex evaluation system for generating the equations</span>
0197                 left{rxnCounter}=<span class="string">''</span>;
0198                 right{rxnCounter}=<span class="string">''</span>;
0199                 coefficient=<span class="string">''</span>;
0200                 templeft=<span class="string">''</span>;
0201                 tempright=<span class="string">''</span>;
0202                 <span class="comment">% might be simplified with a better algorithem</span>
0203                 
0204                 <span class="comment">%Add reaction ID</span>
0205                 metaCycRxns.rxns{rxnCounter}=tline(13:end);
0206                 
0207             <span class="keyword">end</span>
0208             
0209             <span class="comment">%Add name</span>
0210             <span class="keyword">if</span> numel(tline)&gt;14 &amp;&amp; strcmp(tline(1:14),<span class="string">'COMMON-NAME - '</span>)
0211                 metaCycRxns.rxnNames{rxnCounter}=tline(15:end);
0212                 
0213                 <span class="comment">%Romve HTML symbols</span>
0214                 metaCycRxns.rxnNames{rxnCounter}=<a href="#_sub1" class="code" title="subfunction newString=removeHTMLcodes(string)">removeHTMLcodes</a>(metaCycRxns.rxnNames{rxnCounter});
0215             <span class="keyword">end</span>
0216             
0217             <span class="comment">%Add eccodes</span>
0218             <span class="keyword">if</span> numel(tline)&gt;15 &amp;&amp; strcmp(tline(1:15),<span class="string">'EC-NUMBER - EC-'</span>)
0219                 <span class="keyword">if</span> isempty(metaCycRxns.eccodes{rxnCounter})
0220                     metaCycRxns.eccodes{rxnCounter}=strcat(<span class="string">'ec-code/'</span>,tline(16:end));
0221                 <span class="keyword">else</span>
0222                     metaCycRxns.eccodes{rxnCounter}=strcat(metaCycRxns.eccodes{rxnCounter},<span class="string">';ec-code/'</span>,tline(16:end));
0223                 <span class="keyword">end</span>
0224             <span class="keyword">end</span>
0225             <span class="keyword">if</span> numel(tline)&gt;16 &amp;&amp; strcmp(tline(1:16),<span class="string">'EC-NUMBER - |EC-'</span>)
0226                 <span class="keyword">if</span> isempty(metaCycRxns.eccodes{rxnCounter})
0227                     metaCycRxns.eccodes{rxnCounter}=strcat(<span class="string">'ec-code/'</span>,tline(17:end-1));
0228                 <span class="keyword">else</span>
0229                     metaCycRxns.eccodes{rxnCounter}=strcat(metaCycRxns.eccodes{rxnCounter},<span class="string">';ec-code/'</span>,tline(17:end-1));
0230                 <span class="keyword">end</span>
0231             <span class="keyword">end</span>
0232             
0233             <span class="comment">%Add pathway id and assign pathway name to subSystem field</span>
0234             <span class="keyword">if</span> numel(tline)&gt;13 &amp;&amp; strcmp(tline(1:13),<span class="string">'IN-PATHWAY - '</span>)
0235                 <span class="keyword">if</span> isempty(metaCycRxns.pwys{rxnCounter})
0236                     metaCycRxns.pwys{rxnCounter}=tline(14:end);
0237                 <span class="keyword">else</span>
0238                     metaCycRxns.pwys{rxnCounter}=strcat(metaCycRxns.pwys{rxnCounter},<span class="string">';'</span>,tline(14:end));
0239                 <span class="keyword">end</span>
0240                 
0241                 [x, y]=ismember(tline(14:end),pwys);
0242                 <span class="keyword">if</span> x
0243                     metaCycRxns.subSystems{rxnCounter,1}{1,numel(metaCycRxns.subSystems{rxnCounter,1})+1}=pwyNames{y};
0244                 <span class="keyword">end</span>
0245             <span class="keyword">end</span>
0246             
0247             <span class="comment">%Add references (pubmed ids)</span>
0248             <span class="keyword">if</span> numel(tline)&gt;12 &amp;&amp; strcmp(tline(1:12),<span class="string">'CITATIONS - '</span>)
0249                 <span class="keyword">if</span> isempty(metaCycRxns.rxnReferences{rxnCounter})
0250                     metaCycRxns.rxnReferences{rxnCounter}=strcat(<span class="string">'pubmed/'</span>,tline(13:end));
0251                 <span class="keyword">else</span>
0252                     metaCycRxns.rxnReferences{rxnCounter}=strcat(metaCycRxns.rxnReferences{rxnCounter},<span class="string">';pubmed/'</span>,tline(13:end));
0253                 <span class="keyword">end</span>
0254             <span class="keyword">end</span>
0255             
0256             <span class="comment">%Add Miriam info (cross-links other database)</span>
0257             <span class="keyword">if</span> numel(tline)&gt;11 &amp;&amp; strcmp(tline(1:11),<span class="string">'DBLINKS - ('</span>)
0258                 dblink=tline(12:end);
0259                 <span class="comment">%KEGG reaction id</span>
0260                 <span class="keyword">if</span> strcmp(dblink(1:12),<span class="string">'LIGAND-RXN &quot;'</span>)
0261                     dblink=dblink(13:end);
0262                     s=strfind(dblink,<span class="string">'&quot;'</span>);
0263                     <span class="keyword">if</span> any(s)
0264                         dblink=dblink(1:s-1);
0265                     <span class="keyword">end</span>
0266                     
0267                     <span class="keyword">if</span> isstruct(metaCycRxns.rxnMiriams{rxnCounter})
0268                         addToIndex=numel(metaCycRxns.rxnMiriams{rxnCounter}.name)+1;
0269                     <span class="keyword">else</span>
0270                         addToIndex=1;
0271                     <span class="keyword">end</span>
0272                     tempStruct=metaCycRxns.rxnMiriams{rxnCounter};
0273                     tempStruct.name{addToIndex,1}=<span class="string">'kegg.reaction'</span>;
0274                     tempStruct.value{addToIndex,1}=dblink;
0275                     metaCycRxns.rxnMiriams{rxnCounter}=tempStruct;
0276                     
0277                     <span class="comment">%For generating the rxnLinks structure</span>
0278                     dbLinkCounter=dbLinkCounter+1;
0279                     rxnLinks.metacyc{dbLinkCounter}=metaCycRxns.rxns{rxnCounter};
0280                     rxnLinks.kegg{dbLinkCounter}=dblink;
0281                     rxnLinks.check{dbLinkCounter}=strcat(metaCycRxns.rxns{rxnCounter},dblink);
0282                 <span class="keyword">end</span>
0283                 
0284                 <span class="comment">%RHEA reaction id</span>
0285                 <span class="keyword">if</span> strcmp(dblink(1:6),<span class="string">'RHEA &quot;'</span>)
0286                     dblink=dblink(7:end);
0287                     s=strfind(dblink,<span class="string">'&quot;'</span>);
0288                     <span class="keyword">if</span> any(s)
0289                         dblink=dblink(1:s-1);
0290                     <span class="keyword">end</span>
0291                     
0292                     <span class="keyword">if</span> isstruct(metaCycRxns.rxnMiriams{rxnCounter})
0293                         addToIndex=numel(metaCycRxns.rxnMiriams{rxnCounter}.name)+1;
0294                     <span class="keyword">else</span>
0295                         addToIndex=1;
0296                     <span class="keyword">end</span>
0297                     tempStruct=metaCycRxns.rxnMiriams{rxnCounter};
0298                     tempStruct.name{addToIndex,1}=<span class="string">'rhea'</span>;
0299                     tempStruct.value{addToIndex,1}=dblink;
0300                     metaCycRxns.rxnMiriams{rxnCounter}=tempStruct;
0301                 <span class="keyword">end</span>
0302             <span class="keyword">end</span>
0303             
0304             <span class="keyword">if</span> numel(tline)&gt;21 &amp;&amp; strcmp(tline(1:21),<span class="string">'REACTION-DIRECTION - '</span>)
0305                 rxnDirection=tline(22:end);
0306                 <span class="keyword">switch</span>(rxnDirection)
0307                     <span class="keyword">case</span> <span class="string">'IRREVERSIBLE-LEFT-TO-RIGHT'</span>
0308                         metaCycRxns.rev(rxnCounter,1)=0;
0309                     <span class="keyword">case</span> <span class="string">'LEFT-TO-RIGHT'</span>
0310                         metaCycRxns.rev(rxnCounter,1)=0;
0311                     <span class="keyword">case</span> <span class="string">'PHYSIOL-LEFT-TO-RIGHT'</span>
0312                         metaCycRxns.rev(rxnCounter,1)=0;
0313                     <span class="keyword">case</span> <span class="string">'IRREVERSIBLE-RIGHT-TO-LEFT'</span>
0314                         metaCycRxns.rev(rxnCounter,1)=0;
0315                         reverse=1;
0316                     <span class="keyword">case</span> <span class="string">'RIGHT-TO-LEFT'</span>
0317                         metaCycRxns.rev(rxnCounter,1)=0;
0318                         reverse=1;
0319                     <span class="keyword">case</span> <span class="string">'PHYSIOL-RIGHT-TO-LEFT'</span>
0320                         metaCycRxns.rev(rxnCounter,1)=0;
0321                         reverse=1;
0322                 <span class="keyword">end</span>
0323             <span class="keyword">end</span>
0324             
0325             <span class="comment">%Tag transport reactions</span>
0326             <span class="keyword">if</span> strcmp(tline,<span class="string">'TYPES - Transport-Reactions'</span>)
0327                 TRANSPORT=[TRANSPORT;metaCycRxns.rxns{rxnCounter}];
0328             <span class="keyword">end</span>
0329             
0330             <span class="comment">%Add spontaneous</span>
0331             <span class="keyword">if</span> strcmp(tline,<span class="string">'SPONTANEOUS? - T'</span>)
0332                 <span class="comment">%metaCycRxns.spontaneous(rxnCounter,1)=1;</span>
0333                 isSpontaneous(rxnCounter)=true;
0334             <span class="keyword">end</span>
0335             
0336             <span class="comment">%Extract mass-balance status</span>
0337             <span class="keyword">if</span> numel(tline)&gt;27 &amp;&amp; strcmp(tline(1:27),<span class="string">'REACTION-BALANCE-STATUS - :'</span>)
0338                 <span class="keyword">if</span> isequal(tline(28:35), <span class="string">'UNBALANC'</span>)
0339                     UNBALANCED(rxnCounter)=true;
0340                 <span class="keyword">elseif</span> isequal(tline(28:35), <span class="string">'UNDETERM'</span>)
0341                     UNDETERMINED(rxnCounter)=true;
0342                 <span class="keyword">end</span>
0343             <span class="keyword">end</span>
0344             
0345             <span class="comment">%Add left side equation</span>
0346             <span class="keyword">if</span> numel(tline)&gt;7 &amp;&amp; strcmp(tline(1:7),<span class="string">'LEFT - '</span>)
0347                 <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>)
0348                     <span class="keyword">if</span> strcmp(templeft,<span class="string">''</span>)
0349                         templeft=tline(8:end); <span class="comment">% this is the real first, save to a temp variable</span>
0350                     <span class="keyword">else</span> <span class="comment">% count in the coefficient here</span>
0351                         <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0352                             left{rxnCounter}=templeft;
0353                         <span class="keyword">else</span>
0354                             left{rxnCounter}=strcat(coefficient,32,templeft);
0355                             coefficient=<span class="string">''</span>;
0356                         <span class="keyword">end</span>
0357                         templeft=tline(8:end);
0358                     <span class="keyword">end</span>
0359                 <span class="keyword">else</span>
0360                     <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0361                         left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,templeft);
0362                     <span class="keyword">else</span>
0363                         left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,templeft);
0364                         coefficient=<span class="string">''</span>;
0365                     <span class="keyword">end</span>
0366                     templeft=tline(8:end);
0367                 <span class="keyword">end</span>
0368             <span class="keyword">end</span>
0369             
0370             <span class="comment">%Add right side equation</span>
0371             <span class="keyword">if</span> numel(tline)&gt;8 &amp;&amp; strcmp(tline(1:8),<span class="string">'RIGHT - '</span>)
0372                 <span class="keyword">if</span> strcmp(right{rxnCounter},<span class="string">''</span>)
0373                     <span class="keyword">if</span> strcmp(tempright,<span class="string">''</span>)
0374                         
0375                         <span class="comment">% a complicated process for the last left</span>
0376                         <span class="comment">% metabolite</span>
0377                         <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0378                             <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>)
0379                                 left{rxnCounter}=templeft;
0380                             <span class="keyword">else</span>
0381                                 left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,templeft);
0382                             <span class="keyword">end</span>
0383                             
0384                         <span class="keyword">else</span>
0385                             <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>)
0386                                 left{rxnCounter}=strcat(coefficient,32,templeft);
0387                             <span class="keyword">else</span>
0388                                 left{rxnCounter}=strcat(left{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,templeft);
0389                             <span class="keyword">end</span>
0390                             coefficient=<span class="string">''</span>;
0391                         <span class="keyword">end</span>
0392                         <span class="comment">% process end</span>
0393                         
0394                         tempright=tline(9:end); <span class="comment">% this is the real first, save to a temp variable</span>
0395                     <span class="keyword">else</span>
0396                         <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0397                             right{rxnCounter}=tempright;
0398                         <span class="keyword">else</span>
0399                             right{rxnCounter}=strcat(coefficient,32,tempright);
0400                             coefficient=<span class="string">''</span>;
0401                         <span class="keyword">end</span>
0402                         tempright=tline(9:end);
0403                     <span class="keyword">end</span>
0404                 <span class="keyword">else</span>
0405                     <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0406                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,tempright);
0407                     <span class="keyword">else</span>
0408                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,tempright);
0409                         coefficient=<span class="string">''</span>;
0410                     <span class="keyword">end</span>
0411                     tempright=tline(9:end);
0412                 <span class="keyword">end</span>
0413                 
0414             <span class="keyword">end</span>
0415             
0416             <span class="keyword">if</span> numel(tline)&gt;15 &amp;&amp; strcmp(tline(1:15),<span class="string">'^COEFFICIENT - '</span>)
0417                 coefficient=tline(16:end);
0418             <span class="keyword">end</span>
0419             
0420             <span class="comment">%Generate equation at the end of each object section</span>
0421             <span class="keyword">if</span> strcmp(tline,<span class="string">'//'</span>)
0422                 
0423                 <span class="comment">% a complicated process for the last right metabolite,</span>
0424                 <span class="comment">% sub-function is needed here</span>
0425                 <span class="keyword">if</span> strcmp(coefficient,<span class="string">''</span>)
0426                     <span class="keyword">if</span> strcmp(right{rxnCounter},<span class="string">''</span>)
0427                         right{rxnCounter}=tempright;
0428                     <span class="keyword">else</span>
0429                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,tempright);
0430                     <span class="keyword">end</span>
0431                     
0432                 <span class="keyword">else</span>
0433                     <span class="keyword">if</span> strcmp(right{rxnCounter},<span class="string">''</span>)
0434                         right{rxnCounter}=strcat(coefficient,32,tempright);
0435                     <span class="keyword">else</span>
0436                         right{rxnCounter}=strcat(right{rxnCounter},<span class="string">' +'</span>,32,coefficient,32,tempright);
0437                     <span class="keyword">end</span>
0438                     coefficient=<span class="string">''</span>;
0439                 <span class="keyword">end</span>
0440                 <span class="comment">% process end</span>
0441                 
0442                 <span class="comment">%get the right direction symbol</span>
0443                 <span class="keyword">if</span> metaCycRxns.rev(rxnCounter,1)
0444                     symbol = <span class="string">' &lt;=&gt;'</span>;
0445                 <span class="keyword">else</span>
0446                     symbol = <span class="string">' =&gt;'</span>;
0447                 <span class="keyword">end</span>
0448                 
0449                 <span class="keyword">if</span> reverse
0450                     metaCycRxns.equations{rxnCounter}=strcat(right{rxnCounter},symbol,32,left{rxnCounter});
0451                 <span class="keyword">else</span>
0452                     metaCycRxns.equations{rxnCounter}=strcat(left{rxnCounter},symbol,32,right{rxnCounter});
0453                 <span class="keyword">end</span>
0454                 
0455                 <span class="comment">%Final equation check</span>
0456                 <span class="keyword">if</span> strcmp(left{rxnCounter},<span class="string">''</span>) || strcmp(right{rxnCounter},<span class="string">''</span>)
0457                     rxnCounter=rxnCounter-1;
0458                     
0459                 <span class="keyword">end</span>
0460                 
0461             <span class="keyword">end</span>
0462             
0463         <span class="keyword">end</span>
0464         <span class="comment">%Close the file</span>
0465         fclose(fid);
0466         
0467         <span class="comment">%===</span>
0468         UNBALANCED=metaCycRxns.rxns(UNBALANCED);
0469         UNDETERMINED=metaCycRxns.rxns(UNDETERMINED);
0470         isSpontaneous=metaCycRxns.rxns(isSpontaneous);
0471         
0472         <span class="comment">%If too much space was allocated, shrink the model</span>
0473         metaCycRxns.rxns=metaCycRxns.rxns(1:rxnCounter);
0474         metaCycRxns.rxnNames=metaCycRxns.rxnNames(1:rxnCounter);
0475         metaCycRxns.eccodes=metaCycRxns.eccodes(1:rxnCounter);
0476         metaCycRxns.equations=metaCycRxns.equations(1:rxnCounter);
0477         metaCycRxns.rxnMiriams=metaCycRxns.rxnMiriams(1:rxnCounter);
0478         metaCycRxns.rxnReferences=metaCycRxns.rxnReferences(1:rxnCounter);
0479         metaCycRxns.subSystems=metaCycRxns.subSystems(1:rxnCounter);
0480         metaCycRxns.pwys=metaCycRxns.pwys(1:rxnCounter);
0481         metaCycRxns.rev=metaCycRxns.rev(1:rxnCounter,:);
0482         
0483         rxnLinks.kegg=rxnLinks.kegg(1:dbLinkCounter);
0484         rxnLinks.metacyc=rxnLinks.metacyc(1:dbLinkCounter);
0485         rxnLinks.check=rxnLinks.check(1:dbLinkCounter);
0486         [~,index]=unique(rxnLinks.check);
0487         rxnLinks.kegg=rxnLinks.kegg(index);
0488         rxnLinks.metacyc=rxnLinks.metacyc(index);
0489         rxnLinks=rmfield(rxnLinks,<span class="string">'check'</span>);
0490         
0491         <span class="comment">%Construct the S matrix and list of metabolites</span>
0492         [S, mets, badRxns]=constructS(metaCycRxns.equations);
0493         metaCycRxns.S=S;
0494         metaCycRxns.mets=mets;
0495         
0496         <span class="comment">%Add some stuff to get a correct model structure</span>
0497         metaCycRxns.ub=ones(rxnCounter,1)*1000;
0498         metaCycRxns.lb=metaCycRxns.rev*-1000;
0499         metaCycRxns.c=zeros(rxnCounter,1);
0500         metaCycRxns.b=zeros(numel(metaCycRxns.mets),1);
0501         metaCycRxns.version=version;
0502         
0503         <span class="comment">%Save the model structure</span>
0504         save(rxnsFile,<span class="string">'metaCycRxns'</span>,<span class="string">'rxnLinks'</span>,<span class="string">'TRANSPORT'</span>,<span class="string">'UNBALANCED'</span>,<span class="string">'UNDETERMINED'</span>,<span class="string">'isSpontaneous'</span>);
0505         fprintf([<span class="string">'New metaCycRxns.mat has been successfully updated!\n\n'</span>]);
0506     <span class="keyword">end</span>
0507 <span class="keyword">end</span>
0508 
0509 <span class="comment">%Deal with reactions that are labeled as &quot;TRANSPORT&quot;, &quot;UNBALANCED&quot;, or</span>
0510 <span class="comment">%&quot;UNDETERMINED&quot; (depending on settings).</span>
0511 model=metaCycRxns;
0512 <span class="keyword">if</span> keepTransportRxns==false
0513     model=removeReactions(model,intersect(TRANSPORT,model.rxns),true,true);
0514 <span class="keyword">end</span>
0515 <span class="keyword">if</span> keepUnbalanced==false
0516     model=removeReactions(model,intersect(UNBALANCED,model.rxns),true,true);
0517 <span class="keyword">end</span>
0518 <span class="keyword">if</span> keepUndetermined==false
0519     model=removeReactions(model,intersect(UNDETERMINED,model.rxns),true,true);
0520 <span class="keyword">end</span>
0521 <span class="keyword">end</span>
0522 
0523 <span class="comment">%Sub function for romving HTML symbols from the names of reaction and</span>
0524 <span class="comment">%pathway</span>
0525 <a name="_sub1" href="#_subfunctions" class="code">function newString=removeHTMLcodes(string)</a>
0526 string=regexprep(string,<span class="string">'&lt;(\w+)&gt;'</span>,<span class="string">''</span>);
0527 string=regexprep(string,<span class="string">'&lt;/(\w+)&gt;'</span>,<span class="string">''</span>);
0528 string=regexprep(string,<span class="string">'[&amp;;]'</span>,<span class="string">''</span>);
0529 newString=string;
0530 <span class="keyword">end</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>